<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script> function calculateBMI() {
        let l = document.getElementById('height').value / 100
        let m = document.getElementById('weight').value
        let bmi = (m / (l * l)).toFixed(1)
        bmi = parseFloat(bmi);
        if (l > 0 && m > 0) {
            document.getElementById('bmi').value = bmi;
        }
    }

    function clearHeightAndWeight() {
        document.getElementById('height').value = ''
        document.getElementById('weight').value = ''
    }

    function getReproductiveHistory() {
        if (document.getElementById('nulliparous').checked) {
            return -0.25753237109
            //return 'nulliparous'
        }
        if (document.getElementById('parous').checked) {
            return 0
            //return 'parous'
        }
        if (document.getElementById('cesarean').checked) {
            return 0.17790428473
            //return 'cesarean'
        }
    }

    function getUterusWeight(op_method) {
        if (document.getElementById('leq300').checked) {
            switch (op_method) {
                case 'Laparoscopy':
                    return 0.639;
                case 'Robot':
                    return 0;
                case 'Vaginal':
                    return 0.63587863907;
                default:
                    return 0;
            }
        }
        if (document.getElementById('from301to500').checked) {
            switch (op_method) {
                case 'Laparoscopy':
                    return 1.31038680806;
                case 'Robot':
                    return 0.19661758574;
                case 'Vaginal':
                    return 1.53212454421;
                default:
                    return 1.31038680806;
            }
        }
        if (document.getElementById('from501to1000').checked) {
            switch (op_method) {
                case 'Laparoscopy':
                    return 1.66434402345;
                case 'Robot':
                    return 0.56874314872;
                case 'Vaginal':
                    return 2.38879307711;
                default:
                    return 1.66434402345;
            }
        }
        if (document.getElementById('g1000').checked) {
            switch (op_method) {
                case 'Laparoscopy':
                    return 2.43707001539;
                case 'Robot':
                    return 1.66551704210;
                case 'Vaginal':
                    return 3.22308415145;
                default:
                    return 2.43707001539;
            }
        }
    }

    function getIndication() {
        if (document.getElementById('pain').checked) {
            return 0
        }
        if (document.getElementById('prolapse').checked) {
            return -0.37863568523
        }
        if (document.getElementById('endometriosis').checked) {
            return 0.59144240428
        }
        if (document.getElementById('bleeding').checked) {
            return -0.22184901812
        }
        if (document.getElementById('dysplasia').checked) {
            return -0.56682841277
        }
        if (document.getElementById('other').checked) {
            return -0.23529538177
        }
    }

    function showResult() {
        let age = document.getElementById('age').value;
        let g_age = -0.01837843073*age
        let bmi = document.getElementById('bmi').value;
        let g_bmi = 0.02142440088*bmi
        let g_hist = getReproductiveHistory();
        let g_uw_lap = getUterusWeight('Laparoscopy');
        let g_uw_robot = getUterusWeight('Robot');
        let g_uw_vag = getUterusWeight('Vaginal');
        let g_indication = getIndication();
        let beta0 = -0.28588178205;
        let g_lap = beta0 + g_age + g_bmi + g_hist + g_indication + g_uw_lap;
        let g_robot = beta0 + g_age + g_bmi + g_hist + g_indication + g_uw_robot;
        let g_vag = beta0 + g_age + g_bmi + g_hist + g_indication + g_uw_vag;

        let risk_lap = Math.exp(g_lap)/(1+Math.exp(g_lap))
        let risk_robot = Math.exp(g_robot)/(1+Math.exp(g_robot))
        let risk_vag = Math.exp(g_vag)/(1+Math.exp(g_vag))

        let message;
        message = `Laparoscopy: ${(100 * risk_lap).toFixed(1)} %
    Robot: ${(100 * risk_robot).toFixed(1)} %
    Vaginal: ${(100 * risk_vag).toFixed(1)} %`;
        //console.log("HEJ");
        document.getElementById('result').innerText = message;
        //document.getElementById('result').innerHTML = age
    }
    function clearInput() {
        document.getElementById('age').value = '';
        document.getElementById('height').value = '';
        document.getElementById('weight').value = '';
        document.getElementById('bmi').value = ''
        document.getElementById('parous').checked = true;
        document.getElementById('leq300').checked = true;
        document.getElementById('pain').checked = true;
        let message;
        message = `Laparoscopy:\n    Robot:\n    Vaginal:`;
        document.getElementById('result').innerText = message;
    }
    </script>
    <style>.outer-container {
        display: flex;
        flex-direction: column;
        align-items:  center;
    }
    h1,h4{max-width: 600px}
    h4{margin-top: -20px;}

    .input-container {
        display: grid;
        grid-template-columns: 175px 50px;
        grid-template-rows: repeat(2, 20px);
        grid-gap: 1px;
        padding-bottom: 25px;
    }

    .radio-container {
        border-style: solid;
        border-radius: 5px;
        border-width: 1px;
        width: 240px;
    }

    .block-container {
        display: grid;
        grid-template-columns: 260px 260px;
    }

    .result-box {
        padding-top: 5px;
        padding-left: 5px;
        border-style: solid;
        border-radius: 5px;
        border-width: 1px;
        width: 240px;
        padding-bottom: 5px;
    }</style>
</head>
<body>
<div class="outer-container">
<h1>Risk of complications after minimally invasive hysterectomy</h1>
<h4>Defined as any deviation from the normal peri- or post-operative course (perioperative or postoperative complication, conversion, blood loss more than 300 ml, re-operation, need of postoperative antibiotics)</h4>
<div class="block-container">
    <div>
<div class=input-container>
    <label for="age">Age (years):</label><input type="text" id="age" size="1" maxlength="3"/>
    <Label for="height">Height (cm):</Label>
    <input type="text" onkeyup=calculateBMI() id="height" size="1" maxlength="3"/>
    <Label for="weight">Weight (kg)</Label>
    <input type="text" onkeyup=calculateBMI() id="weight" size="1" maxlength="3"/>
    <Label for="bmi">Body Mass Index (kg/m<sup>2</sup>)</Label>
    <input type="text" onkeyup=clearHeightAndWeight() id="bmi" size="1" maxlength="3"/>


</div>
<Label>Reproductive history</Label>
<div class=radio-container>

    <input type="radio" id="nulliparous" name="repr" value="nulliparous">
    <label for="nulliparous">Nulliparous</label><br>
    <input type="radio" id="parous" name="repr" value="parous" checked>
    <label for="parous">Parous, no cesarean</label><br>
    <input type="radio" id="cesarean" name="repr" value="cesarean">
    <label for="cesarean">Cesarean section</label>
</div>
<br>

<Label>Estimated uterus weight</Label>
<div class=radio-container>

    <input type="radio" id="leq300" name="uweight" value="leq300" checked>
    <label for="leq300"><=300 g</label><br>
    <input type="radio" id="from301to500" name="uweight" value="from301to500">
    <label for="from301to500">301 - 500 g</label><br>
    <input type="radio" id="from501to1000" name="uweight" value="from501to1000">
    <label for="from501to1000">501 - 1000 g</label><br>
    <input type="radio" id="g1000" name="uweight" value="g1000">
    <label for="g1000">>1000 g</label><br>

</div>
<br>

<Label>Indication for hysterectomy</Label>
<div class=radio-container>

    <input type="radio" id="pain" name="indication" value="pain" checked>
    <label for="pain">Menorrhagia/pain/dysmenorrhea</label><br>
    <input type="radio" id="prolapse" name="indication" value="prolapse">
    <label for="prolapse">Prolapse</label><br>
    <input type="radio" id="endometriosis" name="indication" value="endometriosis">
    <label for="endometriosis">Endometriosis</label><br>
    <input type="radio" id="bleeding" name="indication" value="bleeding">
    <label for="bleeding">Post-menopausal bleeding</label><br>
    <input type="radio" id="dysplasia" name="indication" value="dysplasia">
    <label for="dysplasia">Cervical dysplasia</label><br>
    <input type="radio" id="other" name="indication" value="other">
    <label for="other">Other</label><br>

</div>
    </div>

<div>

<button onclick=showResult()>Calculate risk</button>
<p id="result" class="result-box">Laparoscopy:<br>
    Robot:<br>
    Vaginal:</p>
    <button onclick=clearInput()>Clear all</button>
</div>
</div>
<!--
<button py-click="calculate">Calculate</button>
<div id="output" style="height:50px"></div>
<p id="demo"></p>
-->
</div>
</body>
</html>